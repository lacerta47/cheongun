<!DOCTYPE html>
<html>
<head>
<title>로블록스 공포게임</title>
<style>
  body {
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    margin: 0;
    background-color: #333;
    color: white;
  }
  #game-container {
    position: relative;
    width: 800px;
    height: 600px;
    border: 2px solid white;
    background-color: #111;
    overflow: hidden;
  }
  #player {
    position: absolute;
    width: 25px; /* 1인치 만들기 요청 */
    height: 25px; /* 1인치 만들기 요청 */
    background-color: blue;
    left: 50px;
    top: 50%;
    transform: translateY(-50%);
    transition: all 0.1s linear;
  }
  #ghost {
    position: absolute;
    width: 40px;
    height: 40px;
    background-color: red;
    left: 700px;
    top: 50%;
    transform: translateY(-50%);
    transition: all 0.5s linear;
  }
  #home {
    position: absolute;
    width: 60px;
    height: 60px;
    background-color: green;
    right: 20px;
    bottom: 20px;
  }
  .item {
    position: absolute;
    width: 25px;
    height: 25px;
    background-color: yellow;
    cursor: grab;
  }
  #item1 { top: 100px; left: 200px; }
  #item2 { top: 400px; left: 500px; }
  #item3 { top: 250px; left: 350px; }

  #path {
    position: absolute;
    top: 100px;
    left: 50px;
    width: 700px;
    height: 400px;
    border: 2px dashed #555;
    pointer-events: none; /* So it doesn't interfere with clicks */
  }

  #controls {
    position: fixed;
    bottom: 20px;
    left: 20px;
    right: 20px;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
  }
  .left-controls button, .right-controls button {
    padding: 15px 25px;
    font-size: 18px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
  }
  .left-controls {
    display: flex;
    gap: 10px;
  }
  #message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    color: white;
    background-color: rgba(0,0,0,0.7);
    padding: 20px;
    border-radius: 10px;
    display: none; /* Initially hidden */
    text-align: center;
  }
  #bag {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 150px;
    min-height: 100px;
    border: 2px solid white;
    background-color: rgba(0,0,0,0.5);
    padding: 5px;
  }
  #bag-title {
    text-align: center;
    font-weight: bold;
    border-bottom: 1px solid white;
    margin-bottom: 5px;
  }
  #bag-items {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
  }
  .collected-item {
    width: 20px;
    height: 20px;
    background-color: yellow;
  }
</style>
</head>
<body>

  <h1>로블록스 공포게임</h1>
  <div id="game-container">
    <div id="path"></div>
    <div id="player"></div>
    <div id="ghost"></div>
    <div id="home">집</div>
    <div id="item1" class="item"></div>
    <div id="item2" class="item"></div>
    <div id="item3" class="item"></div>
    <div id="message"></div>
    <div id="bag">
      <div id="bag-title">가방</div>
      <div id="bag-items"></div>
    </div>
  </div>

  <div id="controls">
    <div class="left-controls">
      <button id="crouch-btn">웅크리기</button>
      <button id="walk-btn">걷기</button>
    </div>
    <div class="right-controls">
      <button id="run-btn">달리기</button>
    </div>
  </div>

<script>

const player = document.getElementById('player');
const ghost = document.getElementById('ghost');
const home = document.getElementById('home');
let itemsNodeList = document.querySelectorAll('.item');
let items = Array.from(itemsNodeList); // Convert to array to easily remove items
const gameContainer = document.getElementById('game-container');
const bagItems = document.getElementById('bag-items');
const message = document.getElementById('message');

const crouchBtn = document.getElementById('crouch-btn');
const walkBtn = document.getElementById('walk-btn');
const runBtn = document.getElementById('run-btn');

let playerSpeed = 5;
let ghostSpeed = 2;
let level = 1;
let gameOver = false;
let levelTransition = false;
let keys = {};

let playerState = 'walk'; // 'walk', 'run', 'crouch'

// Player Movement
document.addEventListener('keydown', (e) => { keys[e.key] = true; });
document.addEventListener('keyup', (e) => { keys[e.key] = false; });

function movePlayer() {
    if (gameOver || levelTransition) return;

    let playerRect = player.getBoundingClientRect();
    let containerRect = gameContainer.getBoundingClientRect();

    let newLeft = player.offsetLeft;
    let newTop = player.offsetTop;

    if (keys['ArrowUp'] || keys['w']) newTop -= playerSpeed;
    if (keys['ArrowDown'] || keys['s']) newTop += playerSpeed;
    if (keys['ArrowLeft'] || keys['a']) newLeft -= playerSpeed;
    if (keys['ArrowRight'] || keys['d']) newLeft += playerSpeed;

    // Boundary checks
    if (newLeft < 0) newLeft = 0;
    if (newTop < 0) newTop = 0;
    if (newLeft + playerRect.width > containerRect.width) newLeft = containerRect.width - playerRect.width;
    if (newTop + playerRect.height > containerRect.height) newTop = containerRect.height - playerRect.height;


    player.style.left = newLeft + 'px';
    player.style.top = newTop + 'px';
}

// Ghost AI
function moveGhost() {
    if (gameOver) return;

    let playerRect = player.getBoundingClientRect();
    let ghostRect = ghost.getBoundingClientRect();

    let dx = (playerRect.left + playerRect.width / 2) - (ghostRect.left + ghostRect.width / 2);
    let dy = (playerRect.top + playerRect.height / 2) - (ghostRect.top + ghostRect.height / 2);
    let distance = Math.sqrt(dx * dx + dy * dy);

    if (distance > 1) {
        ghost.style.left = (ghost.offsetLeft + (dx / distance) * ghostSpeed) + 'px';
        ghost.style.top = (ghost.offsetTop + (dy / distance) * ghostSpeed) + 'px';
    }
}

// Drag and Drop Items
let activeItem = null;
let offsetX, offsetY;

items.forEach(item => {
    item.addEventListener('mousedown', (e) => {
        if (gameOver) return;
        activeItem = item;
        offsetX = e.clientX - activeItem.getBoundingClientRect().left;
        offsetY = e.clientY - activeItem.getBoundingClientRect().top;
        activeItem.style.cursor = 'grabbing';
    });
});

document.addEventListener('mousemove', (e) => {
    if (activeItem) {
        let containerRect = gameContainer.getBoundingClientRect();
        let x = e.clientX - containerRect.left - offsetX;
        let y = e.clientY - containerRect.top - offsetY;

        // Boundary checks for items
        if (x < 0) x = 0;
        if (y < 0) y = 0;
        if (x + activeItem.offsetWidth > containerRect.width) x = containerRect.width - activeItem.offsetWidth;
        if (y + activeItem.offsetHeight > containerRect.height) y = containerRect.height - activeItem.offsetHeight;


        activeItem.style.left = x + 'px';
        activeItem.style.top = y + 'px';
    }
});

document.addEventListener('mouseup', () => {
    if (activeItem) {
        activeItem.style.cursor = 'grab';
        activeItem = null;
    }
});


// Collision Detection
function checkCollision(rect1, rect2) {
    return !(rect1.right < rect2.left ||
             rect1.left > rect2.right ||
             rect1.bottom < rect2.top ||
             rect1.top > rect2.bottom);
}

// Game Loop
function gameLoop() {
    if (gameOver) return;

    movePlayer();
    moveGhost();

    const playerRect = player.getBoundingClientRect();
    const ghostRect = ghost.getBoundingClientRect();
    const homeRect = home.getBoundingClientRect();

    // Check for game over
    if (checkCollision(playerRect, ghostRect)) {
        endGame('귀신에게 잡혔다!');
    }

    // Check for win
    if (checkCollision(playerRect, homeRect)) {
        winGame();
    }

    // Check for item collection
    items.forEach((item, index) => {
        const itemRect = item.getBoundingClientRect();
        if (checkCollision(playerRect, itemRect)) {
            item.style.display = 'none'; // Hide item from game
            const collectedItem = document.createElement('div');
            collectedItem.className = 'collected-item';
            bagItems.appendChild(collectedItem);
            items.splice(index, 1); // Remove from items array
        }
    });

    requestAnimationFrame(gameLoop);
}

function endGame(msg) {
    gameOver = true;
    message.textContent = msg + " (다시 시작하려면 클릭)";
    message.style.display = 'block';
}

function winGame() {
    levelTransition = true;
    level++;
    message.textContent = `레벨 ${level-1} 클리어! 레벨 ${level} 시작!`;
    message.style.display = 'block';
    ghostSpeed += 0.5; // Increase difficulty
    
    // Reset positions
    player.style.left = '50px';
    player.style.top = '50%';
    ghost.style.left = '700px';
    ghost.style.top = '50%';

    setTimeout(() => {
        message.style.display = 'none';
        levelTransition = false;
    }, 2000);
}

// Restart game
message.addEventListener('click', () => {
    if (gameOver) {
        gameOver = false;
        message.style.display = 'none';
        level = 1;
        ghostSpeed = 2;
        player.style.left = '50px';
        player.style.top = '50%';
        ghost.style.left = '700px';
        ghost.style.top = '50%';
        gameLoop();
    }
});

// Button controls
crouchBtn.addEventListener('click', () => {
    if (playerState !== 'crouch') {
        playerState = 'crouch';
        playerSpeed = 2;
        player.style.height = '15px';
        player.style.width = '35px';
    }
});

walkBtn.addEventListener('click', () => {
    if (playerState !== 'walk') {
        playerState = 'walk';
        playerSpeed = 5;
        player.style.height = '30px';
        player.style.width = '30px';
    }
});

runBtn.addEventListener('click', () => {
    if (playerState !== 'run') {
        playerState = 'run';
        playerSpeed = 8;
        player.style.height = '30px';
        player.style.width = '30px';
    }
});


// Start the game
gameLoop();

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>축구 게임</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #game-board {
            width: 800px;
            height: 500px;
            background-color: #4CAF50; /* 축구장 잔디 색 */
            border: 5px solid white;
            position: relative;
            overflow: hidden;
        }
        #player {
            width: 40px;
            height: 40px;
            background-color: blue;
            border-radius: 50%;
            position: absolute;
            bottom: 20px;
            left: 380px;
        }
        .teammate {
            width: 40px;
            height: 40px;
            background-color: lightblue; /* 팀원 색상 */
            border-radius: 50%;
            position: absolute;
        }
        #teammate1 {
            bottom: 100px;
            left: 200px;
        }
        #teammate2 {
            bottom: 150px;
            left: 550px;
        }
        .opponent {
            width: 40px;
            height: 40px;
            background-color: green; /* 상대편 색상 */
            border-radius: 50%;
            position: absolute;
        }
        #opponent1 {
            top: 200px;
            left: 150px;
        }
        #opponent2 {
            top: 250px;
            left: 600px;
        }
        #opponent3 {
            top: 80px;
            left: 400px;
        }
        #ball {
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            /* 초기 위치는 선수 바로 위 */
        }
        #goal {
            width: 150px;
            height: 80px;
            border: 3px solid white;
            position: absolute;
            top: 0;
            left: 325px;
        }
        #goalkeeper {
            width: 50px;
            height: 50px;
            background-color: red;
            position: absolute;
            top: 10px;
            left: 375px;
        }
        #message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: yellow;
            display: none;
            text-shadow: 2px 2px 4px black;
        }
    </style>
</head>
<body>

<div id="game-board">
    <div id="goal"></div>
    <div id="player"></div>
    <div id="teammate1" class="teammate"></div>
    <div id="teammate2" class="teammate"></div>
    <div id="opponent1" class="opponent"></div>
    <div id="opponent2" class="opponent"></div>
    <div id="opponent3" class="opponent"></div>
    <div id="ball"></div>
    <div id="goalkeeper"></div>
    <div id="message">골!</div>
</div>

<script>
    const player = document.getElementById('player');
    const ball = document.getElementById('ball');
    const goalkeeper = document.getElementById('goalkeeper');
    const goal = document.getElementById('goal');
    const gameBoard = document.getElementById('game-board');
    const message = document.getElementById('message');

    const opponents = document.querySelectorAll('.opponent');
    const teammates = document.querySelectorAll('.teammate');

    let playerX = 380;
    let playerY = 440; // game-board height - player height - bottom margin
    let ballX = playerX + 10;
    let ballY = playerY - 20;
    let isShooting = false;

    // 초기 선수 및 공 위치 설정
    player.style.left = playerX + 'px';
    player.style.top = playerY + 'px';
    ball.style.left = ballX + 'px';
    ball.style.top = ballY + 'px';


    // 키보드 이벤트 처리
    document.addEventListener('keydown', (e) => {
        if (isShooting) return; // 슛 중에는 움직임 방지

        const speed = 10;
        if (e.key === 'ArrowLeft' && playerX > 0) {
            playerX -= speed;
        } else if (e.key === 'ArrowRight' && playerX < gameBoard.clientWidth - player.clientWidth) {
            playerX += speed;
        } else if (e.key === 'ArrowUp' && playerY > gameBoard.clientHeight / 2) { // 중앙선 넘지 않도록
            playerY -= speed;
        } else if (e.key === 'ArrowDown' && playerY < gameBoard.clientHeight - player.clientHeight) {
            playerY += speed;
        }

        if (e.key === ' ') { // 스페이스바로 슛
            isShooting = true;
            shootBall();
        }

        // 선수와 공 위치 업데이트
        player.style.left = playerX + 'px';
        player.style.top = playerY + 'px';
        if (!isShooting) {
            ball.style.left = (playerX + 10) + 'px';
            ball.style.top = (playerY - 20) + 'px';
        }

        checkCollision();
    });

    function shootBall() {
        let shootInterval = setInterval(() => {
            ballY -= 15; // 공이 위로 날아가는 속도
            ball.style.top = ballY + 'px';

            // 골키퍼와 공의 충돌 감지
            const gkRect = goalkeeper.getBoundingClientRect();
            const ballRect = ball.getBoundingClientRect();

            if (ballRect.top < gkRect.bottom && ballRect.right > gkRect.left && ballRect.left < gkRect.right && ballRect.bottom > gkRect.top) {
                clearInterval(shootInterval);
                resetPositions();
                return;
            }

            // 골대와 공의 충돌 감지
            const goalRect = goal.getBoundingClientRect();
            if (ballRect.top < goalRect.bottom && ballRect.right > goalRect.left && ballRect.left < goalRect.right) {
                 if (ballY < 0) { // 공이 골라인을 완전히 넘었을 때
                    clearInterval(shootInterval);
                    showMessageAndReset();
                    return;
                 }
            }


            // 공이 경기장 밖으로 나갔을 때
            if (ballY < 0) {
                clearInterval(shootInterval);
                resetPositions();
            }
        }, 20);
    }

    function checkCollision() {
        const playerRect = player.getBoundingClientRect();

        opponents.forEach(op => {
            const opRect = op.getBoundingClientRect();

            // Check for overlap
            if (
                playerRect.left < opRect.right &&
                playerRect.right > opRect.left &&
                playerRect.top < opRect.bottom &&
                playerRect.bottom > opRect.top
            ) {
                resetPositions(); // Ball is stolen, reset position
            }
        });
    }

    function showMessageAndReset() {
        message.style.display = 'block';
        setTimeout(() => {
            message.style.display = 'none';
            resetPositions();
        }, 1500); // 1.5초 후 메시지 숨기고 리셋
    }


    function resetPositions() {
        isShooting = false;
        playerX = 380;
        playerY = 440;
        ballX = playerX + 10;
        ballY = playerY - 20;

        player.style.left = playerX + 'px';
        player.style.top = playerY + 'px';
        ball.style.left = ballX + 'px';
        ball.style.top = ballY + 'px';
    }

    // 골키퍼 움직임
    let gkDirection = 1; // 1 for right, -1 for left
    function moveGoalkeeper() {
        let gkX = parseInt(goalkeeper.style.left);
        const gkSpeed = 3;

        gkX += gkSpeed * gkDirection;
        goalkeeper.style.left = gkX + 'px';

        if (gkX > (goal.offsetLeft + goal.clientWidth - goalkeeper.clientWidth) || gkX < goal.offsetLeft) {
            gkDirection *= -1; // 방향 전환
        }
    }

    setInterval(moveGoalkeeper, 50);

    // 상대편 선수들 움직임
    opponents.forEach(op => {
        op.direction = 1; // 1 for right, -1 for left
    });

    function moveOpponents() {
        opponents.forEach(op => {
            let opX = parseInt(window.getComputedStyle(op).left);
            const opSpeed = 2;

            opX += opSpeed * op.direction;
            op.style.left = opX + 'px';

            // 경기장 경계에 닿으면 방향 전환
            if (opX > gameBoard.clientWidth - op.clientWidth || opX < 0) {
                op.direction *= -1;
            }
        });
    }

    setInterval(moveOpponents, 70);

    // 팀원들 움직임
    teammates.forEach(team => {
        team.originalX = parseInt(window.getComputedStyle(team).left);
        team.originalY = parseInt(window.getComputedStyle(team).top);
    });

    function moveTeammates() {
        teammates.forEach(team => {
            const moveX = team.originalX + (Math.random() * 20 - 10); // -10 to +10 px range
            const moveY = team.originalY + (Math.random() * 10 - 5); // -5 to +5 px range

            team.style.left = moveX + 'px';
            team.style.top = moveY + 'px';
        });
    }

    setInterval(moveTeammates, 500);

</script>

</body>
</html>
